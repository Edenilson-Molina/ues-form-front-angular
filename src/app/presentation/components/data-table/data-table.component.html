<div
  class="datatable-custom-component shadow-md dark:shadow-[0_6px_8px_0px_rgba(255,255,255,0.2)] border dark:border-none"
  [ngClass]="'rounded-' + roundedTypeTable"
  [ngStyle]="getCustomStyles()"
>
  <p-table
    [value]="data"
    [loading]="loadingData"
    [stripedRows]="stripedRows"
    [scrollable]="scrollable"
    [scrollHeight]="scrollable ? scrollHeight : undefined"
    [styleClass]="styleClass"
    [tableStyleClass]="tableClass"
    [tableStyle]="tableStyle"
  >
    <!-- Empty Template -->
    <ng-template #emptymessage *ngIf="!loadingData">
      <tr>
        <td [attr.colspan]="columns.length + 1">
          <div
            class="w-full flex justify-center flex-col gap-2 py-5 text-yellow-400 dark:text-yellow-700"
          >
            <span
              class="material-symbols-outlined text-center"
              style="font-size: 40px"
            >
              error
            </span>
            <h1 class="font-bold text-primary-dark text-center">
              Sin datos para mostrar
            </h1>
          </div>
        </td>
      </tr>
    </ng-template>

    <!-- Loading Template -->
    <ng-template #loadingbody *ngIf="loadingData">
      <tr>
        <td [attr.colspan]="columns.length + 1">
          <div class="flex justify-center items-center">
            <p-progress-spinner
              styleClass="w-[50px] h-[300px]"
              strokeWidth="5"
              fill="transparent"
              animationDuration=".9s"
              aria-label="Custom ProgressSpinner"
            >
            </p-progress-spinner>
          </div>
        </td>
      </tr>
    </ng-template>

    <!-- Header Template -->
    <ng-template #header>
      <tr>
        <th
          *ngFor="let column of columns; let index = index"
          [pSortableColumn]="column.sortable ? column.field : undefined"
          [ngStyle]="column.headerStyle"
          [ngClass]="getHeaderClass(column, index)"
        >
          <div
            [class]="'flex items-center gap-2 cursor-pointer justify-' + this.headerAlign"
          >
            {{ column.header }}
            <p-sortIcon
              *ngIf="column.sortable"
              [field]="column.field"
            ></p-sortIcon>
          </div>
        </th>
        <th
          *ngIf="actionButtonsConfiguration.length > 0"
          [ngClass]="
            getHeaderClass(
              { header: 'Acciones', field: 'actions' },
              columns.length
            )
          "
          [class]="'justify-' + headerAlign"
        >
          <div
              [class]="'flex items-center gap-2 cursor-pointer justify-' + this.headerAlign"
            >
            Acciones
          </div>
        </th>
      </tr>
    </ng-template>

    <!-- Body Template -->
    <ng-template #body let-rowData>
      <tr>
        <td
          *ngFor="let column of columns"
          [ngStyle]="column.bodyStyle"
          [ngClass]="getBodyClass(column)"
        >
          <!-- Use custom template if available -->
          <ng-container *ngIf="columnTemplates[column.field]; else defaultCell">
            <ng-container
              *ngTemplateOutlet="
                columnTemplates[column.field];
                context: { $implicit: rowData, data: rowData }
              "
            ></ng-container>
          </ng-container>

          <!-- Default cell template -->
          <ng-template #defaultCell>
            {{ rowData[column.field] }}
          </ng-template>
        </td>

        <!-- Actions column -->
        <td
          *ngIf="actionButtonsConfiguration.length > 0"
          [ngClass]="'flex justify-' + actionsAlign + ' items-center gap-2'"
        >
          <!-- Use custom actions template if available -->
          <ng-container *ngIf="actionsTemplate; else defaultActions">
            <ng-container
              *ngTemplateOutlet="
                actionsTemplate;
                context: { $implicit: rowData, data: rowData }
              "
            ></ng-container>
          </ng-container>

          <!-- Default actions template -->
          <ng-template #defaultActions>
            <span
              *ngFor="
                let actionButton of actionButtonsConfiguration;
                let i = index
              "
              class="material-symbols-outlined p-1 w-auto transition-all duration-300 ease-in-out flex justify-center items-center cursor-pointer"
              [ngClass]="actionButton.class"
              [pTooltip]="actionButton.label"
              tooltipPosition="top"
              (click)="actionButton.onClick(rowData)"
            >
              {{ actionButton.icon }}
            </span>
          </ng-template>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Pagination -->
  <div
    *ngIf="showPagination"
    [ngClass]="{ 'pagination-custom-design': paginationCustomDesign }"
  >
    <p-paginator
      styleClass="py-5 bg-transparent"
      [rows]="pagination.perPage"
      [first]="pagination.from - 1"
      [totalRecords]="pagination.total"
      [rowsPerPageOptions]="rowsPerPageOptions"
      (onPageChange)="handlePageChange($event)"
    >
    </p-paginator>
  </div>
</div>
